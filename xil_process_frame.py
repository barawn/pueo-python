# This horrible-ness is how you extract the 128 BRAM bits
# contained in a 2976 bit (93x32) frame in a Xilinx UltraScale+
# device.
# The mappings do not change, ever, for any block RAM.
# Each RAMB36 consists of 256 total frames.
# So to read out a block RAM, you just set the FAR register
# to its starting frame address (from the LL file),
# read 23,808 32-bit integers (or 95,232 bytes),
# slice them up by frame, and call this.
#
# To do this with the hacked-up modified readback,
# you need to increase the read length because of
# God Knows What The Hell.
#
# Trial-and-error says there's a 472-byte offset, so you need
# to read 95,704 bytes.
#
# You can then just read in from numpy:
# raw = np.fromfile("bram_dump", dtype=np.uint32)
# fr = raw[118:]
# frames = np.reshape(fr, (256, 93))
# r = bytearray()
# for frame in frames:
#     r += xil_process_frame(frame.tobytes('C'))
def xil_process_frame(f):
    r = bytearray(16)
    r[ 0 ] |= ((f[ 30 ] >>  0 )&0x1) <<  0
    r[ 0 ] |= ((f[ 46 ] >>  4 )&0x1) <<  1
    r[ 0 ] |= ((f[ 31 ] >>  4 )&0x1) <<  2
    r[ 0 ] |= ((f[ 48 ] >>  0 )&0x1) <<  3
    r[ 0 ] |= ((f[ 33 ] >>  0 )&0x1) <<  4
    r[ 0 ] |= ((f[ 49 ] >>  4 )&0x1) <<  5
    r[ 0 ] |= ((f[ 34 ] >>  4 )&0x1) <<  6
    r[ 0 ] |= ((f[ 51 ] >>  0 )&0x1) <<  7
    r[ 1 ] |= ((f[ 37 ] >>  4 )&0x1) <<  0
    r[ 1 ] |= ((f[ 54 ] >>  0 )&0x1) <<  1
    r[ 1 ] |= ((f[ 39 ] >>  0 )&0x1) <<  2
    r[ 1 ] |= ((f[ 55 ] >>  4 )&0x1) <<  3
    r[ 1 ] |= ((f[ 40 ] >>  4 )&0x1) <<  4
    r[ 1 ] |= ((f[ 57 ] >>  0 )&0x1) <<  5
    r[ 1 ] |= ((f[ 42 ] >>  0 )&0x1) <<  6
    r[ 1 ] |= ((f[ 58 ] >>  4 )&0x1) <<  7
    r[ 2 ] |= ((f[ 30 ] >>  6 )&0x1) <<  0
    r[ 2 ] |= ((f[ 47 ] >>  2 )&0x1) <<  1
    r[ 2 ] |= ((f[ 32 ] >>  2 )&0x1) <<  2
    r[ 2 ] |= ((f[ 48 ] >>  6 )&0x1) <<  3
    r[ 2 ] |= ((f[ 33 ] >>  6 )&0x1) <<  4
    r[ 2 ] |= ((f[ 50 ] >>  2 )&0x1) <<  5
    r[ 2 ] |= ((f[ 35 ] >>  2 )&0x1) <<  6
    r[ 2 ] |= ((f[ 51 ] >>  6 )&0x1) <<  7
    r[ 3 ] |= ((f[ 38 ] >>  2 )&0x1) <<  0
    r[ 3 ] |= ((f[ 54 ] >>  6 )&0x1) <<  1
    r[ 3 ] |= ((f[ 39 ] >>  6 )&0x1) <<  2
    r[ 3 ] |= ((f[ 56 ] >>  2 )&0x1) <<  3
    r[ 3 ] |= ((f[ 41 ] >>  2 )&0x1) <<  4
    r[ 3 ] |= ((f[ 57 ] >>  6 )&0x1) <<  5
    r[ 3 ] |= ((f[ 42 ] >>  6 )&0x1) <<  6
    r[ 3 ] |= ((f[ 59 ] >>  2 )&0x1) <<  7
    r[ 4 ] |= ((f[ 30 ] >>  3 )&0x1) <<  0
    r[ 4 ] |= ((f[ 46 ] >>  7 )&0x1) <<  1
    r[ 4 ] |= ((f[ 31 ] >>  7 )&0x1) <<  2
    r[ 4 ] |= ((f[ 48 ] >>  3 )&0x1) <<  3
    r[ 4 ] |= ((f[ 33 ] >>  3 )&0x1) <<  4
    r[ 4 ] |= ((f[ 49 ] >>  7 )&0x1) <<  5
    r[ 4 ] |= ((f[ 34 ] >>  7 )&0x1) <<  6
    r[ 4 ] |= ((f[ 51 ] >>  3 )&0x1) <<  7
    r[ 5 ] |= ((f[ 37 ] >>  7 )&0x1) <<  0
    r[ 5 ] |= ((f[ 54 ] >>  3 )&0x1) <<  1
    r[ 5 ] |= ((f[ 39 ] >>  3 )&0x1) <<  2
    r[ 5 ] |= ((f[ 55 ] >>  7 )&0x1) <<  3
    r[ 5 ] |= ((f[ 40 ] >>  7 )&0x1) <<  4
    r[ 5 ] |= ((f[ 57 ] >>  3 )&0x1) <<  5
    r[ 5 ] |= ((f[ 42 ] >>  3 )&0x1) <<  6
    r[ 5 ] |= ((f[ 58 ] >>  7 )&0x1) <<  7
    r[ 6 ] |= ((f[ 31 ] >>  1 )&0x1) <<  0
    r[ 6 ] |= ((f[ 47 ] >>  5 )&0x1) <<  1
    r[ 6 ] |= ((f[ 32 ] >>  5 )&0x1) <<  2
    r[ 6 ] |= ((f[ 49 ] >>  1 )&0x1) <<  3
    r[ 6 ] |= ((f[ 34 ] >>  1 )&0x1) <<  4
    r[ 6 ] |= ((f[ 50 ] >>  5 )&0x1) <<  5
    r[ 6 ] |= ((f[ 35 ] >>  5 )&0x1) <<  6
    r[ 6 ] |= ((f[ 52 ] >>  1 )&0x1) <<  7
    r[ 7 ] |= ((f[ 38 ] >>  5 )&0x1) <<  0
    r[ 7 ] |= ((f[ 55 ] >>  1 )&0x1) <<  1
    r[ 7 ] |= ((f[ 40 ] >>  1 )&0x1) <<  2
    r[ 7 ] |= ((f[ 56 ] >>  5 )&0x1) <<  3
    r[ 7 ] |= ((f[ 41 ] >>  5 )&0x1) <<  4
    r[ 7 ] |= ((f[ 58 ] >>  1 )&0x1) <<  5
    r[ 7 ] |= ((f[ 43 ] >>  1 )&0x1) <<  6
    r[ 7 ] |= ((f[ 59 ] >>  5 )&0x1) <<  7
    r[ 8 ] |= ((f[ 30 ] >>  2 )&0x1) <<  0
    r[ 8 ] |= ((f[ 46 ] >>  6 )&0x1) <<  1
    r[ 8 ] |= ((f[ 31 ] >>  6 )&0x1) <<  2
    r[ 8 ] |= ((f[ 48 ] >>  2 )&0x1) <<  3
    r[ 8 ] |= ((f[ 33 ] >>  2 )&0x1) <<  4
    r[ 8 ] |= ((f[ 49 ] >>  6 )&0x1) <<  5
    r[ 8 ] |= ((f[ 34 ] >>  6 )&0x1) <<  6
    r[ 8 ] |= ((f[ 51 ] >>  2 )&0x1) <<  7
    r[ 9 ] |= ((f[ 37 ] >>  6 )&0x1) <<  0
    r[ 9 ] |= ((f[ 54 ] >>  2 )&0x1) <<  1
    r[ 9 ] |= ((f[ 39 ] >>  2 )&0x1) <<  2
    r[ 9 ] |= ((f[ 55 ] >>  6 )&0x1) <<  3
    r[ 9 ] |= ((f[ 40 ] >>  6 )&0x1) <<  4
    r[ 9 ] |= ((f[ 57 ] >>  2 )&0x1) <<  5
    r[ 9 ] |= ((f[ 42 ] >>  2 )&0x1) <<  6
    r[ 9 ] |= ((f[ 58 ] >>  6 )&0x1) <<  7
    r[ 10 ] |= ((f[ 31 ] >>  0 )&0x1) <<  0
    r[ 10 ] |= ((f[ 47 ] >>  4 )&0x1) <<  1
    r[ 10 ] |= ((f[ 32 ] >>  4 )&0x1) <<  2
    r[ 10 ] |= ((f[ 49 ] >>  0 )&0x1) <<  3
    r[ 10 ] |= ((f[ 34 ] >>  0 )&0x1) <<  4
    r[ 10 ] |= ((f[ 50 ] >>  4 )&0x1) <<  5
    r[ 10 ] |= ((f[ 35 ] >>  4 )&0x1) <<  6
    r[ 10 ] |= ((f[ 52 ] >>  0 )&0x1) <<  7
    r[ 11 ] |= ((f[ 38 ] >>  4 )&0x1) <<  0
    r[ 11 ] |= ((f[ 55 ] >>  0 )&0x1) <<  1
    r[ 11 ] |= ((f[ 40 ] >>  0 )&0x1) <<  2
    r[ 11 ] |= ((f[ 56 ] >>  4 )&0x1) <<  3
    r[ 11 ] |= ((f[ 41 ] >>  4 )&0x1) <<  4
    r[ 11 ] |= ((f[ 58 ] >>  0 )&0x1) <<  5
    r[ 11 ] |= ((f[ 43 ] >>  0 )&0x1) <<  6
    r[ 11 ] |= ((f[ 59 ] >>  4 )&0x1) <<  7
    r[ 12 ] |= ((f[ 30 ] >>  5 )&0x1) <<  0
    r[ 12 ] |= ((f[ 47 ] >>  1 )&0x1) <<  1
    r[ 12 ] |= ((f[ 32 ] >>  1 )&0x1) <<  2
    r[ 12 ] |= ((f[ 48 ] >>  5 )&0x1) <<  3
    r[ 12 ] |= ((f[ 33 ] >>  5 )&0x1) <<  4
    r[ 12 ] |= ((f[ 50 ] >>  1 )&0x1) <<  5
    r[ 12 ] |= ((f[ 35 ] >>  1 )&0x1) <<  6
    r[ 12 ] |= ((f[ 51 ] >>  5 )&0x1) <<  7
    r[ 13 ] |= ((f[ 38 ] >>  1 )&0x1) <<  0
    r[ 13 ] |= ((f[ 54 ] >>  5 )&0x1) <<  1
    r[ 13 ] |= ((f[ 39 ] >>  5 )&0x1) <<  2
    r[ 13 ] |= ((f[ 56 ] >>  1 )&0x1) <<  3
    r[ 13 ] |= ((f[ 41 ] >>  1 )&0x1) <<  4
    r[ 13 ] |= ((f[ 57 ] >>  5 )&0x1) <<  5
    r[ 13 ] |= ((f[ 42 ] >>  5 )&0x1) <<  6
    r[ 13 ] |= ((f[ 59 ] >>  1 )&0x1) <<  7
    r[ 14 ] |= ((f[ 31 ] >>  3 )&0x1) <<  0
    r[ 14 ] |= ((f[ 47 ] >>  7 )&0x1) <<  1
    r[ 14 ] |= ((f[ 32 ] >>  7 )&0x1) <<  2
    r[ 14 ] |= ((f[ 49 ] >>  3 )&0x1) <<  3
    r[ 14 ] |= ((f[ 34 ] >>  3 )&0x1) <<  4
    r[ 14 ] |= ((f[ 50 ] >>  7 )&0x1) <<  5
    r[ 14 ] |= ((f[ 35 ] >>  7 )&0x1) <<  6
    r[ 14 ] |= ((f[ 52 ] >>  3 )&0x1) <<  7
    r[ 15 ] |= ((f[ 38 ] >>  7 )&0x1) <<  0
    r[ 15 ] |= ((f[ 55 ] >>  3 )&0x1) <<  1
    r[ 15 ] |= ((f[ 40 ] >>  3 )&0x1) <<  2
    r[ 15 ] |= ((f[ 56 ] >>  7 )&0x1) <<  3
    r[ 15 ] |= ((f[ 41 ] >>  7 )&0x1) <<  4
    r[ 15 ] |= ((f[ 58 ] >>  3 )&0x1) <<  5
    r[ 15 ] |= ((f[ 43 ] >>  3 )&0x1) <<  6
    r[ 15 ] |= ((f[ 59 ] >>  7 )&0x1) <<  7

    return r
